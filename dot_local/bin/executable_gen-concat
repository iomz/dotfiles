#!/bin/sh

REVERSE_OPT=""

for i in "$@"
do
    case "$i" in
        "-h"|"--help")
            echo "usage: gen-concat [--help|-h]" 1>&2
            echo "  generate /tmp/concat.txt for the mp4 files" 1>&2
            exit
            ;;
        "-r"|"--reverse")
            REVERSE_OPT=" -r"
            ;;
        -*|--*)
            echo "$i: unknown option" 1>&2
            exit 1
    esac
done

rm -f /tmp/concat.txt
#ls -tU ${REVERSE_OPT} | grep "mp4" | xargs -I{} echo "file '$(pwd)/{}'"
find . -type f -name "*.mp4" -print0 | xargs -0 stat -f "%m%t %N" | sort ${REVERSE_OPT} | awk -v pwd=$(pwd) '
{
    printf "file \047";
    sub("^.", pwd, $2);
    printf $2 " ";
    for (i=3; i<NF; i++){
        printf $i " ";
    }
    print $NF "\047";
}' | tee -a /tmp/concat.txt
